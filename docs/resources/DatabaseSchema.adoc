= WIChat Database Schema Documentation
:toc:
:toclevels: 2

== Key Specifications

- **Primary Keys:** All primary key fields (_id) use MongoDBâ€™s native ObjectId.
- **Date Fields:** Dates are stored as BSON Date objects.
- **Array Fields:** List-type data (e.g., distractors) are stored as arrays.
- **Document Model:** Collections are separated for clarity.
- **Referential Integrity:** References are maintained at the application level as MongoDB does not enforce foreign key constraints.

== Collections and Fields

=== User Collection
Stores user information, authentication data, and game statistics.

[cols="2,3"]
|===
|Field |Description

|*_id* (ObjectId) [pk]
|Unique identifier for the user.

|*username* (varchar)
|The user's chosen display name.

|*email* (varchar)
|The user's email address used for login.

|*passwordHash* (varchar)
|Securely stored hash of the user's password.

|*registrationDate* (datetime)
|Timestamp for when the user registered.

|*gamesPlayed* (int)
|Total number of games the user has played.

|*correctAnswers* (int)
|Total number of correct answers provided by the user.

|*incorrectAnswers* (int)
|Total number of incorrect answers provided by the user.
|===

=== Game Collection
Stores each game session played by a user.

[cols="2,3"]
|===
|Field |Description

|*_id* (ObjectId) [pk]
|Unique identifier for a game session.

|*userId* (ObjectId) [ref: > User._id]
|Reference to the User collection (_id).

|*startTime* (datetime)
|Timestamp for when the game started.

|*endTime* (datetime)
|Timestamp for when the game ended.

|*score* (int)
|Final score achieved by the user in the game.
|===

=== Round Collection
Stores individual rounds within a game session.

[cols="2,3"]
|===
|Field |Description

|*_id* (ObjectId) [pk]
|Unique identifier for a round within a game.

|*gameId* (ObjectId) [ref: > Game._id]
|Reference to the Game collection (_id).

|*questionId* (ObjectId) [ref: > Question._id]
|Reference to the Question collection (_id).

|*userAnswer* (varchar)
|The answer provided by the user.

|*isCorrect* (boolean)
|Indicator of whether the user's answer was correct (`true`) or incorrect (`false`).

|*timestamp* (datetime)
|Timestamp for when the user submitted the answer.
|===

=== Question Collection
Stores individual questions for the quiz game.

[cols="2,3"]
|===
|Field |Description

|*_id* (ObjectId) [pk]
|Unique identifier for the question.

|*questionText* (varchar)
|Text of the question.

|*image* (varchar)
|URL to an image associated with the question.

|*correctAnswer* (varchar)
|The correct answer to the question.

|*distractors* (Array of varchar)
|Array of incorrect answers.

|*category* (varchar)
|Category or topic of the question.

|*creationDate* (datetime)
|Timestamp for when the question was created.

|*lastUpdateDate* (datetime)
|Timestamp for the most recent update to the question.

|*status* (varchar)
|Current state of the question. Acceptable values: `active`, `obsolete`, `pending_renewal`.

|*batchId* (varchar) [ref: > QuestionBatch.batchId]
|Reference to the QuestionBatch collection (batchId).
|===

=== QuestionBatch Collection
Groups questions generated from an external data source.

[cols="2,3"]
|===
|Field |Description

|*batchId* (varchar) [pk]
|Unique identifier for the batch.

|*generationDate* (datetime)
|Timestamp for when the batch of questions was generated.
|===

=== HintLog Collection
(Optional) Stores hints provided by an AI model for each question.

[cols="2,3"]
|===
|Field |Description

|*_id* (ObjectId) [pk]
|Unique identifier for the hint log entry.

|*questionId* (ObjectId) [ref: > Question._id]
|Reference to the Question collection (_id).

|*hintText* (varchar)
|Text of the hint provided.

|*timestamp* (datetime)
|Timestamp for when the hint was generated.
|===

== DBML Code

image::databaseSchema.png["Database schema"]


== DBML Code

The following DBML code represents the schema structure. It can be visualized using tools such as https://dbdiagram.io/d.

----
Table User {
  _id ObjectId [pk] // Primary key using ObjectId
  username varchar
  email varchar
  passwordHash varchar
  registrationDate datetime
  gamesPlayed int
  correctAnswers int
  incorrectAnswers int
}

Table Game {
  _id ObjectId [pk]
  userId ObjectId [ref: > User._id]
  startTime datetime
  endTime datetime
  score int
}

Table Round {
  _id ObjectId [pk]
  gameId ObjectId [ref: > Game._id]
  questionId ObjectId [ref: > Question._id]
  userAnswer varchar
  isCorrect boolean
  timestamp datetime
}

Table Question {
  _id ObjectId [pk]
  questionText varchar
  image varchar
  correctAnswer varchar
  distractors [array] // Stored as an array of varchar
  category varchar
  creationDate datetime
  lastUpdateDate datetime
  status varchar
  batchId varchar [ref: > QuestionBatch.batchId]
}

Table QuestionBatch {
  batchId varchar [pk]
  generationDate datetime
}

Table HintLog {
  _id ObjectId [pk]
  questionId ObjectId [ref: > Question._id]
  hintText varchar
  timestamp datetime
}
----
